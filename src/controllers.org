#+TITLE: App


* Introduction

Controllers for handling the following routes :

** addUser

   - URL :: /addUser

   - Method :: POST

   - Data Params ::
     {
      'email': '<value>',
      'name': '<value>',
      'roles' : <value>
     }

   - Success Response ::
     + Code: 200

     + Content:
       #+BEGIN_EXAMPLE
       {
         "email": {
         "email": "xyz@gmail.com",
         "id": "2"
          },
       "id": "2",
       "name": {
       "id": "2",
       "name": "xyz"
          },
       "roles": [
             {
            "id": "2",
            "name": "user"
             }
           ]
       }
       
       #+END_EXAMPLE

** showUser


  - URL :: /showUsers
  - Method :: GET

  - URL Params ::  None
       
  - Success Response ::
    + Code: 200

    + Content ::
      #+BEGIN_EXAMPLE
      [
	{
	  "id": "1",
	  "email": {
	    "email": "xyz@vlabs.ac.in",
	    "id": "1"
	  },
	  "roles": [],
	  "name": {
	    "name": "admin",
	    "id": "1"
	  }
	},
	{
	  "id": "2",
	  "email": {
	    "email": "abc@gmail.com",
	    "id": "2"
	  },
	  "roles": [],
	  "name": {
	    "name": "abc",
	    "id": "2"
	  }
	}
      ]
      #+END_EXAMPLE
* Language Extensions and Imports

#+NAME: extns_and_imports
#+BEGIN_SRC haskell
{-# LANGUAGE DataKinds         #-}
{-# LANGUAGE DeriveGeneric     #-}
{-# LANGUAGE LambdaCase        #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE TypeFamilies      #-}
{-# LANGUAGE TypeOperators     #-}

module App where

import           Control.Monad.IO.Class
import           Control.Monad.Logger (runStderrLoggingT)

import           Data.String.Conversions

import           Database.Persist
import           Database.Persist.Sql
import           Database.Persist.Sqlite

import           Network.Wai
import           Network.Wai.Handler.Warp as Warp

import           Servant

import           Data.Text

import           Api
import           Models

#+END_SRC
* Server handlers

#+NAME: server
#+BEGIN_SRC haskell

server :: ConnectionPool -> Server Api
server pool =
  showUserHandler :<|> addUserHandler
  where
    showUserHandler newUser = liftIO $ userShow newUser
    addUserHandler newUser = liftIO $ userAdd newUser

app :: ConnectionPool -> Application
app pool = serve api $ server pool

#+END_SRC
